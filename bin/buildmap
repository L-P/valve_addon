#!/usr/bin/env sh

set -eux

mapsrc="$(realpath --canonicalize-existing "$1")" # original .map file to export
bsp="$2"
map="$(mktemp --suffix .map)" # exported .map to actually compile
hldir="$(realpath --canonicalize-existing "$(dirname "$0")"/../..)"

goldutil map-export -cleanup-tb "$mapsrc" > "$map"
qbsp -leaktest -hlbsp -wadpath "$hldir" "$map" "$bsp"
vis "$bsp"
light "$bsp"
